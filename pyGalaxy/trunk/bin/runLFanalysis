#!/bin/bash/

cd $PYSU_DIR/pyGalaxy/trunk/bin

#handle the surveys
./calibrate_DEEP2_spectra

./fit_lines_DEEP2_fc_spectra
./fit_lines_VIPERS_spectra
./fit_lines_VVDSDEEP_spectra
./fit_lines_VVDSUDEEP_spectra
./fit_lines_VVDSWIDE_spectra

./compute_line_luminosities_DEEP2
./compute_line_luminosities_VIPERS
./compute_line_luminosities_VVDS
./plotSurveys

# DATA
# compute luminosity functions
./estimate_line_LF
./fit_model_LF_single
./fit_model_LF_all
./plotLFs

# MODEL
# models the LFs
# copy the LFs of interest to $LFMODELS_DIR/data/
cd $LFMODELS_DIR/script
python  convert_biblioPoints_toPlanck15.py
python  fits_H1_4862_LFs.py
python  fits_O3_5007_LFs.py
python  fits_OII_LFs.py

# DATA
# stacks after the luminosity function
cd $PYSU_DIR/pyGalaxy/trunk/bin
./stack_spectra_DEEP2
./stack_spectra_VVDSDEEP

# MODEL
# copy the stacks of interest to $SPECTRASTACKS_DIR/data/
cp $VVDS_DIR/products/spectraStacks/O2_3728/*.fits  $SPECTRASTACKS_DIR/data/O2_3728/
cp $VVDS_DIR/products/spectraStacks/O3_5007/*.fits  $SPECTRASTACKS_DIR/data/O3_5007/
cp $DEEP2_DIR/products/spectraStacks/H1_4862/*.fits  $SPECTRASTACKS_DIR/data/H1_4862/
cp $DEEP2_DIR/products/spectraStacks/O2_3728/*.fits  $SPECTRASTACKS_DIR/data/O2_3728/
cp $DEEP2_DIR/products/spectraStacks/O3_5007/*.fits  $SPECTRASTACKS_DIR/data/O3_5007/
# remove the ones that are not from a complete LF TBD
rm  $SPECTRASTACKS_DIR/data/O2_3728/O2_3728-DEEP2R24.2-z0.778*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-DEEP2R24.2-z0.451*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-DEEP2R24.2-z0.767*
rm  $SPECTRASTACKS_DIR/data/H1_4862/H1_4862-DEEP2R24.2-z0.775*
rm  $SPECTRASTACKS_DIR/data/O2_3728/O2_3728-VVDSDEEPI24-z0.69*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-VVDSDEEPI24-z0.294*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-VVDSDEEPI24-z0.606*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-VVDSDEEPI24-z0.674*
rm  $SPECTRASTACKS_DIR/data/O3_5007/O3_5007-VVDSDEEPI24-z0.741*

# plot the stacks, present the results
cd $SPECTRASTACKS_DIR/scripts/
python presentationPlot.py
python plotStacks.py

# fit firefly stellar population continuum models
cd $PYSU_DIR/pySPM/trunk/bin
screen python setup_run_for_stacks_VVDSDEEP
screen python setup_run_for_stacks_DEEP2
# writes to to $SPECTRASTACKS_DIR/fits/

# RUN CODE FROM HERE ON :

cd $PYSU_DIR/pyGalaxy/trunk/bin
# relink things correclty :
screen python model_stacked_spectra_DEEP2
screen python model_stacked_spectra_VVDS
# writes to to $SPECTRASTACKS_DIR/model/

#redo plot to illustrate fits
#write routine to compile table 
#science plots
./plot_firefly_model

./compute_intrinsic_LFs

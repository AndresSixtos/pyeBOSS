#!/usr/bin/env python

"""
This script produces quality plots to check that the LFs are fine.
"""

import sys
import os
from os.path import join
data_dir = os.environ['DATA_DIR']
import glob

from lib_plot import *
#from lineListAir import *
SNlim = 5

plotDir=join(data_dir, "VIPERS", "products", "emissionLineLuminosityFunctions", "plotLF-ratio")


lf_measurement_files=glob.glob(join(data_dir,"VIPERS", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-VIPERS*z0.7*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[0]
dataRef = n.loadtxt( lf_ref, unpack=True)

label = n.array(["I<21.5", "I<22.0", "I<22.5"])
phiRatio = n.empty([ 3, len(dataRef[0]) ])
for jj in n.arange(1,4,1):
	lf_obs=lf_measurement_files[jj]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_VIPERS_trendMag-z0.75.jpg"))
p.clf()


label = n.array(["g-r>0", "g-r>0.5", "g-r>1", "g-r<1", "g-r<1.5", "g-r<2"])
phiRatio = n.empty([ 6, len(dataRef[0]) ])
for jj in n.arange(4,10,1):
	lf_obs=lf_measurement_files[jj]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_VIPERS_trendGR-z0.75.jpg"))
p.clf()



label = n.array(["r-z>0", "r-z>0.5", "r-z>1", "r-z<1", "r-z<1.5", "r-z<2"])
phiRatio = n.empty([ 6, len(dataRef[0]) ])
for jj in n.arange(10,16,1):
	lf_obs=lf_measurement_files[jj]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_VIPERS_trendRZ-z0.75.jpg"))
p.clf()





















lf_measurement_files=glob.glob(join(data_dir,"VIPERS", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-VIPERSI*z0.9*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[-1]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array(["I<22.0", "I<22.5", "I<23.0","I<23.5"])
for jj in range(len(lf_measurement_files[:-1])):
	lf_obs=lf_measurement_files[jj]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_VIPERS_trendMag-z0.9.jpg"))
p.clf()

lf_measurement_files=glob.glob(join(data_dir,"VIPERS", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-VIPERSI*z1.1*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[-1]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array(["I<22.0", "I<22.5", "I<23.0","I<23.5"])
for jj in range(len(lf_measurement_files[:-1])):
	lf_obs=lf_measurement_files[jj]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_VIPERS_trendMag-z1.1.jpg"))
p.clf()


plotDir=join(data_dir, "DEEP2", "products", "emissionLineLuminosityFunctions", "plotLF-ratio")

lf_measurement_files=glob.glob(join(data_dir,"DEEP2", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-*z1*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[0]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array([ "R<22.5", "R<23.0","R<23.5"])
for jj in range(len(lf_measurement_files[1:])):
	lf_obs=lf_measurement_files[jj+1]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_DEEP2_trendMag-z1.2.jpg"))
p.clf()


lf_measurement_files=glob.glob(join(data_dir,"DEEP2", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-*z0.9*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[0]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array([ "R<22.5", "R<23.0","R<23.5"])
for jj in range(len(lf_measurement_files[1:])):
	lf_obs=lf_measurement_files[jj+1]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_DEEP2_trendMag-z0.9.jpg"))
p.clf()


lf_measurement_files=glob.glob(join(data_dir,"DEEP2", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-*z0.8*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[0]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array([ "R<22.5", "R<23.0","R<23.5"])
for jj in range(len(lf_measurement_files[1:])):
	lf_obs=lf_measurement_files[jj+1]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_DEEP2_trendMag-z0.8.jpg"))
p.clf()


lf_measurement_files=glob.glob(join(data_dir,"DEEP2", "products", "emissionLineLuminosityFunctions", "O2_3728", "O2_3728-*z0.7*.txt") )
lf_measurement_files.sort()

lf_ref=lf_measurement_files[0]
dataRef = n.loadtxt( lf_ref, unpack=True)
phiRatio = n.empty([ len(lf_measurement_files[:-1]), len(dataRef[0]) ])
label = n.array([ "R<22.5", "R<23.0","R<23.5"])
for jj in range(len(lf_measurement_files[1:])):
	lf_obs=lf_measurement_files[jj+1]
	data= n.loadtxt( lf_obs, unpack=True)
	phiRatio[jj] = data[3] / dataRef[3]	
	print lf_obs
	

p.figure(0,(6,6))
for jj in range(len(label)):
	p.plot(dataRef[2],phiRatio[jj],label=label[jj])

p.xlabel(r'$log_{10}(L[O_{II}])$ [erg s$^{-1}$]')
p.ylabel(r'$\Phi/\Phi_{ref}$')
p.xscale('log')
p.xlim((1e40,1e43))
p.ylim((-0.05,1.05))
p.grid()
p.legend(loc=2)
p.savefig(join(plotDir,"O2_3728_DEEP2_trendMag-z0.7.jpg"))
p.clf()










#! /usr/bin/env python

from ModelSpectraStacks import *
import glob
from os.path import join
import os

data_dir = os.environ['VVDS_DIR']

stack_files=n.hstack(( n.array( glob.glob(join( data_dir, "products", "spectraStacks", "*", "*.fits")))))
stack_files.sort()

#print stack_files

for file in stack_files:
	print( file )
	if len(glob.glob(file[:-4]+"*modeled*"))>0:
		print( file, "out" )
		continue

	mm=ModelSpectraStacks(file)
	#mm.plot_fit()
	mm.fit_lines_to_lineSpectrum()
	mm.compute_derived_quantities()
	mm.save_spectrum()
	#mm.plot_spectrum()



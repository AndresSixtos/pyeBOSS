#! /usr/bin/env python
import os
from os.path import join

from ModelSpectraStacks import *
import glob
stack_files=n.array(glob.glob( join( os.environ['SPECTRASTACKS_DIR'], "data", "O2_????", "*DEEP2*.fits" ) ) )
stack_files.sort()

#print stack_files

for file in stack_files:
	print( file )
	#if len(glob.glob(file[:-7]+"*modeled*"))>0:
	#	print( file, "out" )
	#	continue
    #
	mm=ModelSpectraStacks(file,mode="MILES")
	#mm.plot_fit()
	mm.fit_lines_to_lineSpectrum()
	mm.compute_derived_quantities()
	mm.save_spectrum()
	#mm.plot_spectrum()


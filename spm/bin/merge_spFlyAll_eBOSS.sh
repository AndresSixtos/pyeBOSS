#!/bin/bash
#PBS -l walltime=200:00:00
#PBS -o $EBOSSDR14_DIR/spallFly.eboss.o.$PBS_JOBID
#PBS -e $EBOSSDR14_DIR/spallFly.eboss.e$PBS_JOBID
#PBS -M comparat@mpe.mpg.de

cd $EBOSSDR14_DIR/catalogs
ls $EBOSSDR14_DIR/stellarpop/*/spFlyPlate*.fits > flyAllList

java -jar ~/stilts.jar tcat in=@flyAllList ifmt=fits \
	icmd='keepcols "PROGRAMNAME CHUNK PLATEQUALITY PLATESN2 DEREDSN2 PRIMTARGET SECTARGET BLUEFIBER XFOCAL YFOCAL BOSS_TARGET1 BOSS_TARGET2 ANCILLARY_TARGET1 ANCILLARY_TARGET2 EBOSS_TARGET0 EBOSS_TARGET1 EBOSS_TARGET2 EBOSS_TARGET_ID THING_ID_TARGETING SPECPRIMARY SPECBOSS BOSS_SPECOBJ_ID NSPECOBS CALIBFLUX CALIBFLUX_IVAR PLATE TILE MJD FIBERID RUN2D RUN1D OBJTYPE PLUG_RA PLUG_DEC CLASS SUBCLASS Z Z_ERR RCHI2 DOF VDISP VDISP_ERR VDISPZ VDISPZ_ERR VDISPCHI2 VDISPNPIX VDISPDOF WAVEMIN WAVEMAX WCOVERAGE ZWARNING SN_MEDIAN SN_MEDIAN_ALL CHI68P SPECTROFLUX SPECTROFLUX_IVAR SPECTROSYNFLUX SPECTROSYNFLUX_IVAR SPECTROSKYFLUX ANYANDMASK ANYORMASK Z_NOQSO Z_ERR_NOQSO ZNUM_NOQSO ZWARNING_NOQSO CLASS_NOQSO SUBCLASS_NOQSO RCHI2DIFF_NOQSO SPECOBJID OBJID PARENTID FIELDID RA DEC RAERR DECERR L B OFFSETRA OFFSETDEC PSF_FWHM AIRMASS EXTINCTION SKYFLUX SKYFLUX_IVAR PSFFLUX PSFFLUX_IVAR PSFMAG PSFMAGERR FIBERFLUX FIBERFLUX_IVAR FIBERMAG FIBERMAGERR FIBER2FLUX FIBER2FLUX_IVAR FIBER2MAG FIBER2MAGERR CMODELFLUX CMODELFLUX_IVAR CMODELMAG CMODELMAGERR MODELFLUX MODELFLUX_IVAR MODELMAG MODELMAGERR Chabrier_age_lightW Chabrier_age_lightW_err_plus Chabrier_age_lightW_err_minus Chabrier_metallicity_lightW Chabrier_metallicity_lightW_err_plus Chabrier_metallicity_lightW_err_minus Chabrier_stellar_mass Chabrier_stellar_mass_err_plus Chabrier_stellar_mass_err_minus Chabrier_spm_EBV Chabrier_nComponentsSSP Kroupa_age_lightW Kroupa_age_lightW_err_plus Kroupa_age_lightW_err_minus Kroupa_metallicity_lightW Kroupa_metallicity_lightW_err_plus Kroupa_metallicity_lightW_err_minus Kroupa_stellar_mass Kroupa_stellar_mass_err_plus Kroupa_stellar_mass_err_minus Kroupa_spm_EBV Kroupa_nComponentsSSP  Salpeter_age_lightW Salpeter_age_lightW_err_plus Salpeter_age_lightW_err_minus Salpeter_metallicity_lightW Salpeter_metallicity_lightW_err_plus Salpeter_metallicity_lightW_err_minus Salpeter_stellar_mass Salpeter_stellar_mass_err_plus Salpeter_stellar_mass_err_minus Salpeter_spm_EBV Salpeter_nComponentsSSP "' \
	ocmd='sort plate' \
	omode=out ofmt=fits out=FireflyGalaxyEbossDR14.fits
			
rm flyAllList

	
#cd $SDSSDR12_DIR/catalogs
#ls $SDSSDR12_DIR/stellarpop-m11-kroupa/flyAll_catalogs/*.fits > flyAllList

#java -jar ~/stilts.jar tcat in=@flyAllList ifmt=fits \
#	icmd='keepcols "specObjID mjd plate fiberID run1d run2d plug_ra plug_dec z z_err zwarning class subclass z_noqso z_Err_noqso zWarning_noqso class_noqso subClass_noqso age_lightW_mean age_lightW_err_plus age_lightW_err_minus metallicity_lightW_mean metallicity_lightW_mean_err_plus metallicity_lightW_mean_err_minus stellar_mass stellar_mass_err_plus	 stellar_mass_err_minus spm_EBV nComponentsSSP"' \
#	ocmd='sort plate' \
#	omode=out ofmt=fits out=spFlyAll-kr.fits
			
#PROGRAMNAME CHUNK PLATEQUALITY PLATESN2 DEREDSN2 PRIMTARGET SECTARGET LAMBDA_EFF BLUEFIBER ZOFFSET XFOCAL YFOCAL BOSS_TARGET1 BOSS_TARGET2 ANCILLARY_TARGET1 ANCILLARY_TARGET2 EBOSS_TARGET0 EBOSS_TARGET1 EBOSS_TARGET2 EBOSS_TARGET_ID THING_ID_TARGETING SPECPRIMARY SPECBOSS BOSS_SPECOBJ_ID NSPECOBS CALIBFLUX CALIBFLUX_IVAR PLATE TILE MJD FIBERID RUN2D RUN1D OBJTYPE PLUG_RA PLUG_DEC CLASS SUBCLASS Z Z_ERR RCHI2 DOF RCHI2DIFF TFILE TCOLUMN NPOLY THETA VDISP VDISP_ERR VDISPZ VDISPZ_ERR VDISPCHI2 VDISPNPIX VDISPDOF WAVEMIN WAVEMAX WCOVERAGE ZWARNING SN_MEDIAN SN_MEDIAN_ALL CHI68P FRACNSIGMA FRACNSIGHI FRACNSIGLO SPECTROFLUX SPECTROFLUX_IVAR SPECTROSYNFLUX SPECTROSYNFLUX_IVAR SPECTROSKYFLUX ANYANDMASK ANYORMASK SPEC1_G SPEC1_R SPEC1_I SPEC2_G SPEC2_R SPEC2_I ELODIE_FILENAME ELODIE_OBJECT S9 ELODIE_SPTYPE ELODIE_BV ELODIE_TEFF ELODIE_LOGG ELODIE_FEH ELODIE_Z ELODIE_Z_ERR ELODIE_Z_MODELERR ELODIE_RCHI2 ELODIE_DOF Z_NOQSO Z_ERR_NOQSO ZNUM_NOQSO ZWARNING_NOQSO CLASS_NOQSO SUBCLASS_NOQSO RCHI2DIFF_NOQSO VDISP_LNL SPECOBJID OBJID PARENTID FIELDID SKYVERSION MODE CLEAN RUN RERUN S3 CAMCOL FIELD ID PARENT NCHILD OBJC_TYPE OBJC_PROB_PSF OBJC_FLAGS OBJC_FLAGS2 OBJC_ROWC OBJC_ROWCERR OBJC_COLC OBJC_COLCERR ROWVDEG ROWVDEGERR COLVDEG COLVDEGERR ROWC ROWCERR COLC COLCERR PETROTHETA PETROTHETAERR PETROTH50 PETROTH50ERR PETROTH90 PETROTH90ERR Q QERR U UERR M_E1 M_E2 M_E1E1ERR M_E1E2ERR M_E2E2ERR M_RR_CC M_RR_CCERR M_CR4 M_E1_PSF M_E2_PSF M_RR_CC_PSF M_CR4_PSF THETA_DEV THETA_DEVERR AB_DEV AB_DEVERR THETA_EXP THETA_EXPERR AB_EXP AB_EXPERR FRACDEV FLAGS FLAGS2 TYPE PROB_PSF NPROF PROFMEAN_NMGY PROFERR_NMGY STAR_LNL EXP_LNL DEV_LNL PSP_STATUS PIXSCALE RA DEC CX CY CZ RAERR DECERR L B OFFSETRA OFFSETDEC PSF_FWHM AIRMASS PHI_OFFSET PHI_DEV_DEG PHI_EXP_DEG EXTINCTION SKYFLUX SKYFLUX_IVAR PSFFLUX PSFFLUX_IVAR PSFMAG PSFMAGERR FIBERFLUX FIBERFLUX_IVAR FIBERMAG FIBERMAGERR FIBER2FLUX FIBER2FLUX_IVAR FIBER2MAG FIBER2MAGERR CMODELFLUX CMODELFLUX_IVAR CMODELMAG CMODELMAGERR MODELFLUX MODELFLUX_IVAR MODELMAG MODELMAGERR PETROFLUX PETROFLUX_IVAR PETROMAG PETROMAGERR DEVFLUX DEVFLUX_IVAR DEVMAG DEVMAGERR EXPFLUX EXPFLUX_IVAR EXPMAG EXPMAGERR APERFLUX APERFLUX_IVAR CLOUDCAM CALIB_STATUS NMGYPERCOUNT NMGYPERCOUNT_IVAR TAI RESOLVE_STATUS THING_ID IFIELD BALKAN_ID NOBSERVE NDETECT NEDGE SCORE Chabrier_age_lightW Chabrier_age_lightW_err_plus Chabrier_age_lightW_err_minus Chabrier_metallicity_lightW Chabrier_metallicity_lightW_err_plus Chabrier_metallicity_lightW_err_minus Chabrier_age_massW Chabrier_age_massW_err_plus Chabrier_age_massW_err_minus Chabrier_metallicity_massW Chabrier_metallicity_massW_err_plus Chabrier_metallicity_massW_err_minus Chabrier_stellar_mass Chabrier_stellar_mass_err_plus Chabrier_stellar_mass_err_minus Chabrier_spm_EBV Chabrier_nComponentsSSP Chabrier_stellar_mass_ssp_0 Chabrier_age_ssp_0 Chabrier_metal_ssp_0 Chabrier_SFR_ssp_0 Chabrier_weightMass_ssp_0 Chabrier_weightLight_ssp_0 Chabrier_stellar_mass_ssp_1 Chabrier_age_ssp_1 Chabrier_metal_ssp_1 Chabrier_SFR_ssp_1 Chabrier_weightMass_ssp_1 Chabrier_weightLight_ssp_1 Chabrier_stellar_mass_ssp_2 Chabrier_age_ssp_2 Chabrier_metal_ssp_2 Chabrier_SFR_ssp_2 Chabrier_weightMass_ssp_2 Chabrier_weightLight_ssp_2 Chabrier_stellar_mass_ssp_3 Chabrier_age_ssp_3 Chabrier_metal_ssp_3 Chabrier_SFR_ssp_3 Chabrier_weightMass_ssp_3 Chabrier_weightLight_ssp_3 Chabrier_stellar_mass_ssp_4 Chabrier_age_ssp_4 Chabrier_metal_ssp_4 Chabrier_SFR_ssp_4 Chabrier_weightMass_ssp_4 Chabrier_weightLight_ssp_4 Chabrier_stellar_mass_ssp_5 Chabrier_age_ssp_5 Chabrier_metal_ssp_5 Chabrier_SFR_ssp_5 Chabrier_weightMass_ssp_5 Chabrier_weightLight_ssp_5 Chabrier_stellar_mass_ssp_6 Chabrier_age_ssp_6 Chabrier_metal_ssp_6 Chabrier_SFR_ssp_6 Chabrier_weightMass_ssp_6 Chabrier_weightLight_ssp_6 Chabrier_stellar_mass_ssp_7 Chabrier_age_ssp_7 Chabrier_metal_ssp_7 Chabrier_SFR_ssp_7 Chabrier_weightMass_ssp_7 Chabrier_weightLight_ssp_7 Kroupa_age_lightW Kroupa_age_lightW_err_plus Kroupa_age_lightW_err_minus Kroupa_metallicity_lightW Kroupa_metallicity_lightW_err_plus Kroupa_metallicity_lightW_err_minus Kroupa_age_massW Kroupa_age_massW_err_plus Kroupa_age_massW_err_minus Kroupa_metallicity_massW Kroupa_metallicity_massW_err_plus Kroupa_metallicity_massW_err_minus Kroupa_stellar_mass Kroupa_stellar_mass_err_plus Kroupa_stellar_mass_err_minus Kroupa_spm_EBV Kroupa_nComponentsSSP Kroupa_stellar_mass_ssp_0 Kroupa_age_ssp_0 Kroupa_metal_ssp_0 Kroupa_SFR_ssp_0 Kroupa_weightMass_ssp_0 Kroupa_weightLight_ssp_0 Kroupa_stellar_mass_ssp_1 Kroupa_age_ssp_1 Kroupa_metal_ssp_1 Kroupa_SFR_ssp_1 Kroupa_weightMass_ssp_1 Kroupa_weightLight_ssp_1 Kroupa_stellar_mass_ssp_2 Kroupa_age_ssp_2 Kroupa_metal_ssp_2 Kroupa_SFR_ssp_2 Kroupa_weightMass_ssp_2 Kroupa_weightLight_ssp_2 Kroupa_stellar_mass_ssp_3 Kroupa_age_ssp_3 Kroupa_metal_ssp_3 Kroupa_SFR_ssp_3 Kroupa_weightMass_ssp_3 Kroupa_weightLight_ssp_3 Kroupa_stellar_mass_ssp_4 Kroupa_age_ssp_4 Kroupa_metal_ssp_4 Kroupa_SFR_ssp_4 Kroupa_weightMass_ssp_4 Kroupa_weightLight_ssp_4 Kroupa_stellar_mass_ssp_5 Kroupa_age_ssp_5 Kroupa_metal_ssp_5 Kroupa_SFR_ssp_5 Kroupa_weightMass_ssp_5 Kroupa_weightLight_ssp_5 Kroupa_stellar_mass_ssp_6 Kroupa_age_ssp_6 Kroupa_metal_ssp_6 Kroupa_SFR_ssp_6 Kroupa_weightMass_ssp_6 Kroupa_weightLight_ssp_6 Kroupa_stellar_mass_ssp_7 Kroupa_age_ssp_7 Kroupa_metal_ssp_7 Kroupa_SFR_ssp_7 Kroupa_weightMass_ssp_7 Kroupa_weightLight_ssp_7 Salpeter_age_lightW Salpeter_age_lightW_err_plus Salpeter_age_lightW_err_minus Salpeter_metallicity_lightW Salpeter_metallicity_lightW_err_plus Salpeter_metallicity_lightW_err_minus Salpeter_age_massW Salpeter_age_massW_err_plus Salpeter_age_massW_err_minus Salpeter_metallicity_massW Salpeter_metallicity_massW_err_plus Salpeter_metallicity_massW_err_minus Salpeter_stellar_mass Salpeter_stellar_mass_err_plus Salpeter_stellar_mass_err_minus Salpeter_spm_EBV Salpeter_nComponentsSSP Salpeter_stellar_mass_ssp_0 Salpeter_age_ssp_0 Salpeter_metal_ssp_0 Salpeter_SFR_ssp_0 Salpeter_weightMass_ssp_0 Salpeter_weightLight_ssp_0 Salpeter_stellar_mass_ssp_1 Salpeter_age_ssp_1 Salpeter_metal_ssp_1 Salpeter_SFR_ssp_1 Salpeter_weightMass_ssp_1 Salpeter_weightLight_ssp_1 Salpeter_stellar_mass_ssp_2 Salpeter_age_ssp_2 Salpeter_metal_ssp_2 Salpeter_SFR_ssp_2 Salpeter_weightMass_ssp_2 Salpeter_weightLight_ssp_2 Salpeter_stellar_mass_ssp_3 Salpeter_age_ssp_3 Salpeter_metal_ssp_3 Salpeter_SFR_ssp_3 Salpeter_weightMass_ssp_3 Salpeter_weightLight_ssp_3 Salpeter_stellar_mass_ssp_4 Salpeter_age_ssp_4 Salpeter_metal_ssp_4 Salpeter_SFR_ssp_4 Salpeter_weightMass_ssp_4 Salpeter_weightLight_ssp_4 Salpeter_stellar_mass_ssp_5 Salpeter_age_ssp_5 Salpeter_metal_ssp_5 Salpeter_SFR_ssp_5 Salpeter_weightMass_ssp_5 Salpeter_weightLight_ssp_5 Salpeter_stellar_mass_ssp_6 Salpeter_age_ssp_6 Salpeter_metal_ssp_6 Salpeter_SFR_ssp_6 Salpeter_weightMass_ssp_6 Salpeter_weightLight_ssp_6 Salpeter_stellar_mass_ssp_7 Salpeter_age_ssp_7 Salpeter_metal_ssp_7 Salpeter_SFR_ssp_7 Salpeter_weightMass_ssp_7 Salpeter_weightLight_ssp_7

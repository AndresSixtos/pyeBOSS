#!/bin/bash
#PBS -l walltime=200:00:00
#PBS -o $EBOSSDR14_DIR/spallFly.eboss.o.$PBS_JOBID
#PBS -e $EBOSSDR14_DIR/spallFly.eboss.e$PBS_JOBID
#PBS -M comparat@mpe.mpg.de

cd $EBOSSDR14_DIR/catalogs
ls $EBOSSDR14_DIR/stellarpop/*/spFlyPlate*.fits > flyAllList

java -jar ~/stilts.jar tcat in=@flyAllList ifmt=fits \
icmd='keepcols "SURVEY INSTRUMENT CHUNK PROGRAMNAME PLATERUN PLATEQUALITY PLATESN2 DEREDSN2 LAMBDA_EFF BLUEFIBER ZOFFSET SNTURNOFF NTURNOFF SPECPRIMARY SPECSDSS SPECLEGACY SPECSEGUE SPECSEGUE1 SPECSEGUE2 SPECBOSS BOSS_SPECOBJ_ID SPECOBJID FLUXOBJID BESTOBJID TARGETOBJID PLATEID NSPECOBS FIRSTRELEASE RUN2D RUN1D DESIGNID CX CY CZ XFOCAL YFOCAL SOURCETYPE TARGETTYPE THING_ID_TARGETING THING_ID PRIMTARGET SECTARGET LEGACY_TARGET1 LEGACY_TARGET2 SPECIAL_TARGET1 SPECIAL_TARGET2 SEGUE1_TARGET1 SEGUE1_TARGET2 SEGUE2_TARGET1 SEGUE2_TARGET2 MARVELS_TARGET1 MARVELS_TARGET2 BOSS_TARGET1 BOSS_TARGET2 EBOSS_TARGET0 EBOSS_TARGET1 EBOSS_TARGET2 EBOSS_TARGET_ID ANCILLARY_TARGET1 ANCILLARY_TARGET2 SPECTROGRAPHID PLATE TILE MJD FIBERID OBJID PLUG_RA PLUG_DEC CLASS SUBCLASS Z Z_ERR RCHI2 DOF RCHI2DIFF TFILE TCOLUMN NPOLY THETA VDISP VDISP_ERR VDISPZ VDISPZ_ERR VDISPCHI2 VDISPNPIX VDISPDOF WAVEMIN WAVEMAX WCOVERAGE ZWARNING SN_MEDIAN_ALL SN_MEDIAN CHI68P FRACNSIGMA FRACNSIGHI FRACNSIGLO SPECTROFLUX SPECTROFLUX_IVAR SPECTROSYNFLUX SPECTROSYNFLUX_IVAR SPECTROSKYFLUX ANYANDMASK ANYORMASK SPEC1_G SPEC1_R SPEC1_I SPEC2_G SPEC2_R SPEC2_I ELODIE_FILENAME ELODIE_OBJECT ELODIE_SPTYPE ELODIE_BV ELODIE_TEFF ELODIE_LOGG ELODIE_FEH ELODIE_Z ELODIE_Z_ERR ELODIE_Z_MODELERR ELODIE_RCHI2 ELODIE_DOF Z_NOQSO Z_ERR_NOQSO ZWARNING_NOQSO CLASS_NOQSO SUBCLASS_NOQSO RCHI2DIFF_NOQSO Z_PERSON CLASS_PERSON Z_CONF_PERSON COMMENTS_PERSON CALIBFLUX CALIBFLUX_IVAR Chabrier_age_lightW Chabrier_age_lightW_err_plus Chabrier_age_lightW_err_minus Chabrier_metallicity_lightW Chabrier_metallicity_lightW_err_plus Chabrier_metallicity_lightW_err_minus Chabrier_stellar_mass Chabrier_stellar_mass_err_plus Chabrier_stellar_mass_err_minus Chabrier_spm_EBV Chabrier_nComponentsSSP Kroupa_age_lightW Kroupa_age_lightW_err_plus Kroupa_age_lightW_err_minus Kroupa_metallicity_lightW Kroupa_metallicity_lightW_err_plus Kroupa_metallicity_lightW_err_minus Kroupa_stellar_mass Kroupa_stellar_mass_err_plus Kroupa_stellar_mass_err_minus Kroupa_spm_EBV Kroupa_nComponentsSSP Salpeter_age_lightW Salpeter_age_lightW_err_plus Salpeter_age_lightW_err_minus Salpeter_metallicity_lightW Salpeter_metallicity_lightW_err_plus Salpeter_metallicity_lightW_err_minus Salpeter_stellar_mass Salpeter_stellar_mass_err_plus Salpeter_stellar_mass_err_minus Salpeter_spm_EBV Salpeter_nComponentsSSP"' \
ocmd='sort plate' \
omode=out ofmt=fits out=FireflyGalaxyEbossDR14.fits
			
rm flyAllList

	
#cd $SDSSDR12_DIR/catalogs
#ls $SDSSDR12_DIR/stellarpop-m11-kroupa/flyAll_catalogs/*.fits > flyAllList

#java -jar ~/stilts.jar tcat in=@flyAllList ifmt=fits \
#	icmd='keepcols "specObjID mjd plate fiberID run1d run2d plug_ra plug_dec z z_err zwarning class subclass z_noqso z_Err_noqso zWarning_noqso class_noqso subClass_noqso age_lightW_mean age_lightW_err_plus age_lightW_err_minus metallicity_lightW_mean metallicity_lightW_mean_err_plus metallicity_lightW_mean_err_minus stellar_mass stellar_mass_err_plus	 stellar_mass_err_minus spm_EBV nComponentsSSP"' \
#	ocmd='sort plate' \
#	omode=out ofmt=fits out=spFlyAll-kr.fits
			
#SURVEY INSTRUMENT CHUNK PROGRAMNAME PLATERUN PLATEQUALITY PLATESN2 DEREDSN2 LAMBDA_EFF BLUEFIBER ZOFFSET SNTURNOFF NTURNOFF SPECPRIMARY SPECSDSS SPECLEGACY SPECSEGUE SPECSEGUE1 SPECSEGUE2 SPECBOSS BOSS_SPECOBJ_ID SPECOBJID FLUXOBJID BESTOBJID TARGETOBJID PLATEID NSPECOBS FIRSTRELEASE RUN2D RUN1D DESIGNID CX CY CZ XFOCAL YFOCAL SOURCETYPE TARGETTYPE THING_ID_TARGETING THING_ID PRIMTARGET SECTARGET LEGACY_TARGET1 LEGACY_TARGET2 SPECIAL_TARGET1 SPECIAL_TARGET2 SEGUE1_TARGET1 SEGUE1_TARGET2 SEGUE2_TARGET1 SEGUE2_TARGET2 MARVELS_TARGET1 MARVELS_TARGET2 BOSS_TARGET1 BOSS_TARGET2 EBOSS_TARGET0 EBOSS_TARGET1 EBOSS_TARGET2 EBOSS_TARGET_ID ANCILLARY_TARGET1 ANCILLARY_TARGET2 SPECTROGRAPHID PLATE TILE MJD FIBERID OBJID PLUG_RA PLUG_DEC CLASS SUBCLASS Z Z_ERR RCHI2 DOF RCHI2DIFF TFILE TCOLUMN NPOLY THETA VDISP VDISP_ERR VDISPZ VDISPZ_ERR VDISPCHI2 VDISPNPIX VDISPDOF WAVEMIN WAVEMAX WCOVERAGE ZWARNING SN_MEDIAN_ALL SN_MEDIAN CHI68P FRACNSIGMA FRACNSIGHI FRACNSIGLO SPECTROFLUX SPECTROFLUX_IVAR SPECTROSYNFLUX SPECTROSYNFLUX_IVAR SPECTROSKYFLUX ANYANDMASK ANYORMASK SPEC1_G SPEC1_R SPEC1_I SPEC2_G SPEC2_R SPEC2_I ELODIE_FILENAME ELODIE_OBJECT ELODIE_SPTYPE ELODIE_BV ELODIE_TEFF ELODIE_LOGG ELODIE_FEH ELODIE_Z ELODIE_Z_ERR ELODIE_Z_MODELERR ELODIE_RCHI2 ELODIE_DOF Z_NOQSO Z_ERR_NOQSO ZWARNING_NOQSO CLASS_NOQSO SUBCLASS_NOQSO RCHI2DIFF_NOQSO Z_PERSON CLASS_PERSON Z_CONF_PERSON COMMENTS_PERSON CALIBFLUX CALIBFLUX_IVAR Chabrier_age_lightW Chabrier_age_lightW_err_plus Chabrier_age_lightW_err_minus Chabrier_metallicity_lightW Chabrier_metallicity_lightW_err_plus Chabrier_metallicity_lightW_err_minus Chabrier_stellar_mass Chabrier_stellar_mass_err_plus Chabrier_stellar_mass_err_minus Chabrier_spm_EBV Chabrier_nComponentsSSP Kroupa_age_lightW Kroupa_age_lightW_err_plus Kroupa_age_lightW_err_minus Kroupa_metallicity_lightW Kroupa_metallicity_lightW_err_plus Kroupa_metallicity_lightW_err_minus Kroupa_stellar_mass Kroupa_stellar_mass_err_plus Kroupa_stellar_mass_err_minus Kroupa_spm_EBV Kroupa_nComponentsSSP Salpeter_age_lightW Salpeter_age_lightW_err_plus Salpeter_age_lightW_err_minus Salpeter_metallicity_lightW Salpeter_metallicity_lightW_err_plus Salpeter_metallicity_lightW_err_minus Salpeter_stellar_mass Salpeter_stellar_mass_err_plus Salpeter_stellar_mass_err_minus Salpeter_spm_EBV Salpeter_nComponentsSSP
